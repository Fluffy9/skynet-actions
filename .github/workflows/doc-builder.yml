name: "Documentation Builder"
on: workflow_dispatch

jobs:
  retrieve: 
    name: Build & Deploy
    runs-on: "ubuntu-latest"
    steps: 
      - name: Retrieve Skyd Docs
        run: git clone https://gitlab.com/SkynetLabs/skyd/
      - name: Retrieve Skynet Docs
        run: git clone https://github.com/SkynetLabs/skynet-docs/
      - name: Install Node Slate Tool
        run: git clone https://github.com/center-key/node-slate
      - name: Merge
        run: |
          mv ./node-slate/source/index.yml ./node-slate
          rm -r ./node-slate/source/*
          mv ./skyd/doc/* ./node-slate/source
          mv ./skynet-docs/source/* ./node-slate/source 
          mv ./node-slate/index.yml ./node-slate/source
      - uses: actions/setup-node@v2
        with:
          node-version: '12.18'
      - name: Node Slate Builder
        working-directory: ./node-slate/source
        run: |
          npm install
          npm run build
      - name: Fix Weird index.html
        working-directory: ./node-slate/public
        run: mv ./index.html.html ./index.html
      - name: Deploy to Skynet
        uses: SkynetLabs/deploy-to-skynet-action@v2
        with:
          upload-dir: ./node-slate/public
          github-token: ${{ secrets.GITHUB_TOKEN }}
          registry-seed: ${{ secrets.REGISTRY_SEED || '' }}
          registry-datakey: ${{ secrets.REGISTRY_DATAKEY || '' }}



